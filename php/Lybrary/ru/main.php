<?php

use My_bash_class\My_bash_class;

function print_main_header()
{
    $bash = new My_bash_class();
    $bash->EEF("░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░███╗░░░███╗███████╗██████╗░███████╗██╗░░██╗░░░██╗░░██╗░██████╗░░█████╗░██████╗░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░████╗░████║██╔════╝██╔══██╗██╔════╝██║░░╚██╗░██╔╝░░██║██╔════╝░██╔══██╗██╔══██╗░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░██╔████╔██║█████╗░░██████╔╝█████╗░░██║░░░╚████╔╝░░░██║██║░░██╗░██║░░██║██████╔╝░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░██║╚██╔╝██║██╔══╝░░██╔══██╗██╔══╝░░██║░░░░╚██╔╝░░░░██║██║░░╚██╗██║░░██║██╔══██╗░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░██║░╚═╝░██║███████╗██║░░██║███████╗███████╗██║░░░░░██║╚██████╔╝╚█████╔╝██║░░██║░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╚═╝░░░░░╚═╝╚══════╝╚═╝░░╚═╝╚══════╝╚══════╝╚═╝░░░░░╚═╝░╚═════╝░░╚════╝░╚═╝░░╚═╝░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░███████╗███████╗██╗░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░██╔════╝██╔════╝██║░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█████╗░░█████╗░░██║░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░██╔══╝░░██╔══╝░░██║░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░███████╗██║░░░░░██║░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╚══════╝╚═╝░░░░░╚═╝░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ Mᴏй Mᴀгичᴇᴄᴋий EFI дᴏᴄтᴀʙщиᴋ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
");
}

function delivery_efi($repo)
{
    $bash = new My_bash_class();

    function print_delivery()
    {
        $text = '
        Произходит магия, подождите немного...

';
        $bash = new My_bash_class();
        $bash->bash("clear");
        print_main_header();
        echo $text;
    }

    print_delivery();

    $bash->bash("rm -rf /Volumes/EFI/*");
    print_delivery();
    $bash->bash("rm -rf /Volumes/EFI/.Trashes/*");
    print_delivery();
    $bash->bash("git clone {$repo} /Volumes/EFI/repo-tmp");
    print_delivery();
    $bash->bash("mv /Volumes/EFI/repo-tmp/Folder-MacOS-to-clover-partition/EFI/ /Volumes/EFI/EFI");
    print_delivery();
    $bash->bash("rm -rf /Volumes/EFI/repo-tmp");
    print_delivery();

}

function boot_loader_select_repo($print = true)
{
    $repo_arr = [
        [
            'name' => 'Asus Prime B360M-A i3-9100F RX580',
            'url' => 'git@github.com:merelyigor/Asus-Prime-B360M-A_i3-9100F_RX580.git',
        ],
        [
            'name' => 'Asus Prime B360M-A i3-9100F RX580',
            'url' => 'git@github.com:merelyigor/Asus-Prime-B360M-A_i3-9100F_RX580.git',
        ],
    ];


    $text_header = "
    
    Выбирете какой загрузчик вас интересует:
    
        1) {$repo_arr[0]['name']}
        2) {$repo_arr[1]['name']}
        
        3) Выход из программы :(
        
    ";

    $bash = new My_bash_class();

    if ($print) {
        $bash->bash("clear");
        print_main_header();
        echo $text_header;
    }

    $result = readline("INPUT|ВВОД: ");

    $error = error_input($text_header, ['1', '2', '3'], $result);

    if ($error) {
        $bash->bash("clear");
        print_main_header();
        $bash->EEF($text_header);
        $bash->EEF($error);
        boot_loader_select_repo(false);
    } else {
        switch ($result) {
            case '1':
                delivery_efi($repo_arr[0]['url']);
                break;
            case '2':
                delivery_efi($repo_arr[1]['url']);
                break;
            case '3':
                exit_program('Выход из программы :(');
                break;
            default:
                exit_program('Черт произошла непонятная ошибка которой быть не дожно, походу све поломалось :(');
        }
    }
}

function check_efi_mount($print = true)
{
    $bash = new My_bash_class();
    $text_header_error = "
  У вас нет смонтированного раздела EFI
  Смонтируйте EFI раздел диска или флешки и повторите попытку

  1:Повторить попытку
  2:Выход из программы
  
";

    if (is_dir('/Volumes/EFI/')) {
        boot_loader_select_repo();
    } else {
        if ($print) {
            $bash->bash("clear");
            print_main_header();
            echo $text_header_error;
        }

        $result = readline("INPUT|ВВОД: ");

        $error = error_input($text_header_error, ['1', '2'], $result);

        if ($error) {
            $bash->bash("clear");
            print_main_header();
            $bash->EEF($text_header_error);
            $bash->EEF($error);
            check_efi_mount(false);
        } else {
            if ($result == 1) {
                check_efi_mount(true);
            } elseif ($result == 2) {
                exit_program('Bыxᴏд из программы :(');
            }
        }
    }

}

function start_ru()
{
    $bash = new My_bash_class();
    $bash->bash_escapeshellarg("printf '\e[8;55;140t'");
    $bash->bash("clear");
    print_main_header();

    check_efi_mount();
}